---
title: "TeamAnalysis"
sidebar: false
editor_options: 
  chunk_output_type: console
---

```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(shiny)
library(tidyverse)
library(shinydashboard)
library(shinyWidgets)
library(rvest)
library(httr)
library(purrr)
```


```{r}
# Load the data
Comparing_Teams_Sheet <- read_csv("~/Downloads/Data Science 2/Shiny_final_project/Comparing Teams - Sheet1.csv")
View(Comparing_Teams_Sheet1)
```

```{r}
scrape_nbadata <- function(year){
  url <-str_c("https://www.spotrac.com/nba/cap/_/year/", year, "/sort/cap_maximum_space", sep = "")

nba <- read_html(url)

tables <- html_nodes(nba, css = "table") 

tables

html_table(tables, header = TRUE, fill = TRUE)    # find the right table

nba_data <- html_table(tables, header = TRUE, fill = TRUE)[[1]]  %>%
  mutate(year=year) |>
  mutate(Team = str_sub(Team, start = 1, end = 3))
return(nba_data)
}

scrape_nbadata(2023)

nba <- bind_rows(scrape_nbadata(2017),
          scrape_nbadata(2018),
          scrape_nbadata(2019),
          scrape_nbadata(2020),
          scrape_nbadata(2021),
          scrape_nbadata(2022),
          scrape_nbadata(2023)) %>%
  mutate(WM = "M")

  #select("Rank", "Team", "Players Active", "Avg Age Team", "Total Cap All", "Cap Space All", "Active", "Dead Cap")

#columns have some weird names so it isn't working to grab the ones that match the womens dataset to bind them together

nba
```


### WNBA Salaries

```{r}
scrape_wnbadata <- function(year){
  url <-str_c("https://www.spotrac.com/wnba/cap/_/year/", year, "/sort/cap_maximum_space", sep = "")

wnba <- read_html(url)

tables <- html_nodes(wnba, css = "table") 

tables

html_table(tables, header = TRUE, fill = TRUE)    # find the right table

wnba_data <- html_table(tables, header = TRUE, fill = TRUE)[[1]] |>
  mutate(year=year) |>
  mutate(Team = str_sub(Team, start = 1, end = 3))
wnba_data
}

scrape_wnbadata(2024)

wnba <- bind_rows(scrape_wnbadata(2018),
          scrape_wnbadata(2019),
          scrape_wnbadata(2020), 
          scrape_wnbadata(2021),
          scrape_wnbadata(2022),
          scrape_wnbadata(2023),
          scrape_wnbadata(2024)) %>%
  mutate(WM = "W")

wnba
```

```{r}
all_ba <- wnba %>% bind_rows(nba)
```

